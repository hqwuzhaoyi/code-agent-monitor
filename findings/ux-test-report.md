# CAM 通知系统 UX 测试报告

## 测试目标

核心目标：**用户不看终端也能理解问题并做出决策**

## 评估维度总览

| 维度 | 改进前 | 改进后 | 说明 |
|------|--------|--------|------|
| 可理解性 | 2/5 | 4/5 | 从"只看到命令"到"看到完整问题" |
| 完整性 | 2/5 | 4/5 | 新增 extracted_message 和 options 字段 |
| 可操作性 | 3/5 | 5/5 | 明确的回复指引（A/B/y/n） |
| 简洁性 | 4/5 | 4/5 | 结构化但不冗余 |

---

## 测试场景分析

### 场景 1: 权限请求 - "rm -rf node_modules"

#### 改进前
```
⚠️ CAM cam-xxx

执行: Bash rm -rf node_modules

风险: 🟡 MEDIUM

回复 y 允许 / n 拒绝
```

**问题**：
- 用户只看到命令，不知道 Agent 为什么要执行
- 缺少上下文，无法判断是否合理

#### 改进后
```
⚠️ [cam-xyz789] 请求确认

🔧 操作:
Bash: rm -rf ./node_modules

💡 上下文:
清理依赖目录，准备重新安装以解决版本冲突

⚡ 风险: 🟡 MEDIUM

📝 回复 y 允许 / n 拒绝
```

**评分**：
- 可理解性: 5/5 - 知道为什么要删除
- 完整性: 4/5 - 有上下文说明
- 可操作性: 5/5 - 明确 y/n
- 简洁性: 4/5 - 信息充足但不冗余

---

### 场景 2: 结构确认 - "API/前端结构是否 OK"

#### 改进前
```
💬 CAM cam-xxx

等待输入...

回复内容
```

**问题**：
- 完全不知道在问什么
- 必须切换到终端查看

#### 改进后
```
💬 [cam-abc123] 需要你选择

📋 问题:
你想要增强现有的 React Todo List 还是从头开始？

🔢 选项:
A) 增强现有项目 - 在当前代码基础上添加新功能
B) 从头开始 - 使用最新最佳实践创建全新项目

📝 回复字母选择 (A/B)
```

**评分**：
- 可理解性: 5/5 - 问题清晰
- 完整性: 5/5 - 选项完整
- 可操作性: 5/5 - 知道回复 A 或 B
- 简洁性: 5/5 - 结构清晰

---

### 场景 3: 错误通知 - 编译错误

#### 改进前
```
❌ CAM cam-xxx

Agent 退出

回复查看详情
```

**问题**：
- 不知道什么错误
- 不知道是否需要干预

#### 改进后
```
❌ [cam-exit001] Agent 异常退出

退出码: 1
原因: Process terminated unexpectedly

最后输出:
error: could not compile `myapp`
error[E0382]: borrow of moved value: `data`

回复 "resume" 恢复会话，或 "logs" 查看完整日志
```

**评分**：
- 可理解性: 4/5 - 知道是编译错误
- 完整性: 4/5 - 有错误信息，但可能不够完整
- 可操作性: 5/5 - 知道可以 resume 或查看 logs
- 简洁性: 4/5 - 适度展示错误

---

### 场景 4: 多选项问题 - 选择方案 A/B/C

#### 改进前
```
💬 CAM cam-xxx

等待输入...

回复内容
```

**问题**：
- 完全看不到选项
- 无法做出选择

#### 改进后
```
💬 [cam-abc123] 需要你选择

📋 问题:
项目用途是什么？

🔢 选项:
A) 学习项目 - 用于学习新技术
B) 作品集 - 展示给潜在雇主
C) 实际工具 - 解决真实问题

📝 回复字母选择 (A/B/C)
```

**评分**：
- 可理解性: 5/5 - 问题和选项都清晰
- 完整性: 5/5 - 所有选项都展示
- 可操作性: 5/5 - 明确回复方式
- 简洁性: 5/5 - 结构化展示

---

### 场景 5: AI 提取失败 - Fallback 消息

#### 改进前
```
💬 CAM cam-xxx

[终端最后 30 行原始输出，包含大量 UI 噪音]

回复内容
```

**问题**：
- 大量无关信息
- 难以找到关键问题

#### 改进后
```
⚠️ [cam-fail001] 需要你的输入

📋 无法解析具体问题，请查看终端

🖥️ 终端快照:
⏺ 我分析了你的代码结构...

你觉得这个方案怎么样？
❯

📝 查看终端后回复
```

**评分**：
- 可理解性: 3/5 - 知道需要输入，但不确定具体问题
- 完整性: 3/5 - 有部分上下文，但可能不够
- 可操作性: 4/5 - 知道需要查看终端
- 简洁性: 4/5 - 过滤了 UI 噪音

---

## 用户旅程测试

### 旅程 1: 收到权限请求

```
用户状态: 在开会，手机收到通知

1. 看到通知 → "⚠️ [cam-xxx] 请求确认"
   ✅ 知道是权限请求

2. 理解问题 → "Bash: npm install express"
   ✅ 知道要安装什么包

3. 看上下文 → "Agent 正在添加 Express 框架用于 API 开发"
   ✅ 知道为什么需要

4. 做出决策 → 风险 🟢 LOW，合理
   ✅ 可以放心批准

5. 回复 → "y"
   ✅ 操作完成
```

**结论**: 用户无需查看终端即可完成决策 ✅

### 旅程 2: 收到选择题

```
用户状态: 在地铁上，手机收到通知

1. 看到通知 → "💬 [cam-xxx] 需要你选择"
   ✅ 知道需要做选择

2. 理解问题 → "你想要增强现有项目还是从头开始？"
   ✅ 问题清晰

3. 看选项 → A) 增强现有 B) 从头开始
   ✅ 选项完整

4. 做出决策 → 我想保留现有代码
   ✅ 选择 A

5. 回复 → "A"
   ✅ 操作完成
```

**结论**: 用户无需查看终端即可完成决策 ✅

### 旅程 3: 收到 AI 提取失败的通知

```
用户状态: 在咖啡厅，手机收到通知

1. 看到通知 → "⚠️ [cam-xxx] 需要你的输入"
   ✅ 知道需要输入

2. 理解问题 → "无法解析具体问题，请查看终端"
   ⚠️ 不知道具体问什么

3. 看终端快照 → "你觉得这个方案怎么样？"
   ⚠️ 不知道"这个方案"是什么

4. 做出决策 → 需要查看终端
   ❌ 必须切换到电脑

5. 回复 → 延迟处理
   ⚠️ 用户体验下降
```

**结论**: Fallback 场景仍需改进 ⚠️

---

## 对比分析

### 改进前 vs 改进后

| 方面 | 改进前 | 改进后 |
|------|--------|--------|
| 问题可见性 | ❌ 只看到"等待输入" | ✅ 看到完整问题 |
| 选项展示 | ❌ 完全不可见 | ✅ 结构化列出 |
| 上下文 | ❌ 无或原始终端 | ✅ AI 提取的背景 |
| 回复指引 | ⚠️ 模糊的"回复内容" | ✅ 明确的"回复 A/B" |
| 风险提示 | ⚠️ 只有等级 | ✅ 等级 + emoji + 说明 |

### 核心问题是否解决？

**原始问题**: "只看到建议，不知道原始问题"

**解决程度**: 80% 解决

- ✅ 选择题：完全解决，问题和选项都可见
- ✅ 确认题：完全解决，命令和上下文都可见
- ✅ 开放式：基本解决，问题可见
- ⚠️ AI 提取失败：部分解决，仍需查看终端

---

## 改进建议

### 高优先级

1. **增强 Fallback 机制**
   - 当 AI 提取失败时，尝试更大的上下文窗口
   - 提供"获取更多上下文"的快捷命令
   ```
   📝 回复 "more" 获取更多上下文
   ```

2. **上下文完整性检测**
   - 当 `context_complete: false` 时，自动扩展上下文
   - 在消息中标注"上下文可能不完整"

### 中优先级

3. **添加项目路径提示**
   - 在通知中显示 `project_path`
   - 帮助用户区分多个项目的 Agent
   ```
   📁 项目: ~/workspace/my-app
   ```

4. **历史上下文链接**
   - 对于引用之前内容的问题，提供"查看历史"选项
   ```
   📝 回复 "history" 查看之前的讨论
   ```

### 低优先级

5. **智能回复建议**
   - 对于常见问题，提供推荐回复
   ```
   💡 推荐: A (基于项目类型)
   ```

6. **批量操作优化**
   - 聚合同类通知时，提供一键批准
   ```
   ✅ 5 个 LOW 风险操作待批准
   📝 回复 "approve all" 全部批准
   ```

---

## 用户可能的困惑点

1. **agent_id 不直观**
   - `cam-abc123` 对用户没有意义
   - 建议：显示项目名或任务描述

2. **风险等级理解**
   - 用户可能不清楚 LOW/MEDIUM/HIGH 的具体含义
   - 建议：添加简短说明或示例

3. **回复格式**
   - 用户可能不确定大小写是否敏感
   - 建议：明确说明"回复 A 或 a 均可"

4. **多 Agent 场景**
   - 当有多个 Agent 时，用户可能混淆
   - 建议：在通知中显示任务描述

---

## 总结

改进后的通知系统在大多数场景下实现了"不看终端也能理解问题并做出决策"的目标。

**主要成就**：
- 结构化的消息格式，信息层次清晰
- AI 提取的上下文，减少信息丢失
- 明确的回复指引，降低用户认知负担

**待改进**：
- Fallback 场景的用户体验
- 上下文不完整时的处理
- 多 Agent 场景的区分

**整体评分**: 4/5 ⭐⭐⭐⭐
